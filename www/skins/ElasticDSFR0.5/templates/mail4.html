<roundcube:include file="includes/layout.html" />
<roundcube:include file="includes/menu.html" />

<!-- Titre principal de la page -->
<h1 class="voice">
    <roundcube:label name="mail" />
</h1>

<div class="fr-container--fluid">
    <!-- Section principale contenant la liste des dossiers et le contenu principal -->
    <div class="fr-grid-row fr-grid-row--gutters">
        <!-- Barre latérale contenant les dossiers -->
        <div id="layout-sidebar" class="fr-col-12 fr-col-md-4">
            <nav role="navigation" aria-label="Menu latéral"
                class="fr-sidemenu fr-sidemenu--sticky-full-height fr-mb-0-5v" data-fr-js-sidemenu-actionee="true">
                <div class="fr-sidemenu__inner fr-pt-12v">
                    <button aria-controls="sidemenu-286" aria-expanded="false" class="fr-sidemenu__btn"
                        data-fr-js-collapse-button="true">Dossiers</button>
                    <div id="sidemenu-286" class="fr-collapse" data-fr-js-collapse="true">
                        <ul class="fr-sidemenu__list" data-fr-js-sidemenu-list="true">
                            <li class="fr-sidemenu__item" data-fr-js-sidemenu-item="true">
                                <div>
                                    <!-- Lien pour revenir en arrière -->
                                    <a class="fr-link" href="#back"><span
                                            class="fr-icon-arrow-left-line fr-mr-1v"></span>
                                        <roundcube:label name="back" />
                                    </a>
                                    <!-- Affichage du nom d'utilisateur -->
                                    <span class="fr-badge">
                                        <roundcube:object name="username" />
                                    </span>
                                    <!-- Bouton pour les actions sur les dossiers -->
                                    <button class="fr-btn fr-btn--secondary fr-icon-folder-3-line"
                                        data-fr-opened="false" aria-controls="fr-modal-mailboxoptions">Actions sur les
                                        dossiers</button>
                                </div>
                                <!-- Titre de la liste des dossiers -->
                                <h2 id="aria-label-folderlist" class="fr-h6">
                                    <roundcube:label name="arialabelfolderlist" />
                                </h2>
                                <!-- Liste des dossiers de l'utilisateur -->
                                <div id="folderlist-content" class="scroller">
                                    <roundcube:object name="mailboxlist" id="mailboxlist"
                                        class="treelist listing folderlist" folder_filter="mail" unreadwrap="%s" />
                                </div>
                                <div class="fr-footer__bottom">
                                    <!-- Affichage de l'utilisation du quota si applicable -->
                                    <roundcube:if condition="env:quota" />
                                    <div id="quotadisplay" class="fr-notice fr-notice--sm">
                                        <span class="fr-notice__content">
                                            <roundcube:label name="quota" />
                                            <roundcube:object name="quotaDisplay" class="count" display="text" />
                                        </span>
                                    </div>
                                    <roundcube:endif />
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>

        <!-- Section contenant la liste des messages et leur aperçu -->
        <div id="contenu" class="fr-col-12 fr-col-md-8">
            <div>
                <div class="fr-editor">
                    <div class="fr-grid-row fr-grid-row--gutters">
                        <div class="fr-col">
                            <!-- En-tête de la liste des messages avec les boutons d'action -->
                            <div id="messagelist-header"
                                class="fr-container--fluid fr-background-alt--blue-france fr-pb-2w fr-pt-2w fr-pt-lg-0">
                                <span class="fr-btns-group--inline-md">
                                    <!-- Bouton pour sélectionner les messages -->
                                    <button
                                        class="fr-btn fr-btn--secondary fr-btn--icon-left fr-icon-checkbox-circle-line fr-btn--sm"
                                        data-fr-opened="false" aria-controls="fr-modal-listselect">
                                        <roundcube:label name="select" />
                                    </button>
                                    <!-- Bouton pour les options de gestion des threads si applicable -->
                                    <roundcube:if condition="env:threads" />
                                    <button
                                        class="fr-btn fr-btn--secondary fr-btn--icon-left fr-icon-share-line fr-btn--sm"
                                        data-fr-opened="false" aria-controls="fr-modal-threadselect">
                                        <roundcube:label name="threads" />
                                    </button>
                                    <roundcube:endif />
                                    <!-- Bouton pour les options de liste -->
                                    <button
                                        class="fr-btn fr-btn--secondary fr-btn--icon-left fr-icon-options-line fr-btn--sm"
                                        data-fr-opened="false" aria-controls="fr-modal-listoptions">
                                        <roundcube:label name="options" />
                                    </button>
                                    <!-- Bouton pour rafraîchir la liste des messages -->
                                    <roundcube:button command="checkmail" type="link"
                                        class="fr-btn fr-btn--secondary fr-icon-refresh-line fr-btn--sm" label="refresh"
                                        title="checkmail" innerclass="inner" />
                                    <!-- Bouton pour afficher le menu -->
                                    <a class="fr-btn fr-btn--secondary fr-icon-menu-fill fr-btn--sm"
                                        href="#list-menu"><span class="inner">
                                            <roundcube:label name="menu" />
                                        </span></a>
                                </span>
                            </div>
                            <!-- Formulaire de recherche rapide dans les emails adapté au DSFR -->
                            <form class="fr-search-bar" role="search" id="mailsearchform" style="width: 100%;">
                                <div class="fr-search-bar__wrapper" style="width: 100%;">
                                    <label for="search-input" class="fr-label sr-only">Recherche rapide</label>
                                    <input type="search" id="search-input" name="search" class="fr-input"
                                        placeholder="Rechercher dans les emails" aria-label="Rechercher dans les emails"
                                        required style="width: calc(100% - 2rem);" />
                                    <!-- Adjust width to remove space for icon -->
                                    <button type="submit" class="fr-btn fr-btn--icon-only fr-icon-search-line"
                                        title="Rechercher"></button>
                                </div>
                                <button class="fr-btn fr-btn--secondary" id="searchmenu" aria-expanded="false"
                                    aria-controls="advanced-search-options">
                                    Options de recherche
                                </button>
                            </form> <!-- Liste des messages affichée ici -->
                            
                            <div id="messagelist-content" class="scroller" tabindex="-1">
                                <!-- Titre h2 pour dire "listing" - enlevé<h2 id="aria-label-messagelist" class="fr-h6">
                                    <roundcube:label name="arialabelmessagelist" />
                                </h2> -->
                                <roundcube:object name="messages" id="messagelist"
                                    class="listing messagelist sortheader fixedheader"
                                    aria-labelledby="aria-label-messagelist" data-list="message_list"
                                    data-label-msg="listempty" />
                            </div>
                            <!-- Pagination pour la liste des messages -->
                            <roundcube:include file="includes/pagenav.html" />
                        </div>
                    </div>
                </div>
            </div>

            <div class="fr-grid-row fr-grid-row--gutters">
                <div class="fr-col">
                    <!-- Contenu du message sélectionné affiché ici -->
                    <div id="layout-content"></div>
                    <h2 id="aria-label-toolbar" class="fr-h6">
                        <roundcube:label name="arialabeltoolbar" />
                    </h2>
                    <div class="col" role="toolbar" aria-labelledby="aria-label-toolbar">
                        <!-- Lien pour revenir en arrière -->
                        <a class="fr-link" href="#back"><span class="fr-icon-arrow-left-line fr-mr-1v"></span>
                            <roundcube:label name="back" />
                        </a>
                        <span class="header-title"></span>
                        <!-- Inclut le menu des options de courrier -->
                        <roundcube:include file="includes/mail-menu.html" />
                    </div>
                    <h2 id="aria-label-mailpreviewframe" class="fr-h6">
                        <roundcube:label name="arialabelmailpreviewframe" />
                    </h2>
                    <!-- IFrame pour afficher le contenu du message -->
                    <div>
                        <roundcube:object name="contentframe" id="messagecontframe"
                            aria-labelledby="aria-label-mailpreviewframe" src="env:blankpage"
                            title="arialabelmailpreviewframe" />
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modale pour la sélection de messages -->
<dialog aria-labelledby="fr-modal-listselect-title" id="fr-modal-listselect" class="fr-modal" role="dialog">
    <div class="fr-container fr-container--fluid fr-container-md">
        <div class="fr-grid-row fr-grid-row--center">
            <div class="fr-col-12 fr-col-md-8 fr-col-lg-6">
                <div class="fr-modal__body">
                    <div class="fr-modal__header">
                        <button class="fr-btn--close fr-btn" aria-controls="fr-modal-listselect">Fermer</button>
                    </div>
                    <div class="fr-modal__content">
                        <h1 id="fr-modal-listselect-title" class="fr-modal__title">
                            <span class="fr-icon-checkbox-circle-line fr-icon--lg"></span>
                            Sélection de messages
                        </h1>
                        <ul class="menu listing">
                            <!-- Options pour sélectionner des messages -->
                            <button type="button" class="fr-btn fr-btn--secondary">Sélectionner</button>
                            <button type="button" class="fr-btn fr-btn--secondary">Tout sélectionner</button>
                            <button type="button" class="fr-btn fr-btn--secondary">Page courante</button>
                            <button type="button" class="fr-btn fr-btn--secondary">Non lus</button>
                            <button type="button" class="fr-btn fr-btn--secondary">Marqués</button>
                            <button type="button" class="fr-btn fr-btn--secondary">Inverser</button>
                            <button type="button" class="fr-btn fr-btn--secondary">Aucun</button>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</dialog>

<!-- Modale pour les options de la liste -->
<dialog aria-labelledby="fr-modal-listoptions-title" id="fr-modal-listoptions" class="fr-modal" role="dialog">
    <div class="fr-container fr-container--fluid fr-container-md">
        <div class="fr-grid-row fr-grid-row--center">
            <div class="fr-col-12 fr-col-md-8 fr-col-lg-6">
                <div class="fr-modal__body">
                    <div class="fr-modal__header">
                        <button class="fr-btn--close fr-btn" aria-controls="fr-modal-listoptions">Fermer</button>
                    </div>
                    <div class="fr-modal__content">
                        <h1 id="fr-modal-listoptions-title" class="fr-modal__title">
                            <span class="fr-icon-options-line fr-icon--lg"></span>
                            Options de la liste des messages
                        </h1>
                        <div class="form-group">
                            <!-- Options pour trier la liste des messages -->
                            <label for="listoptions-sortcol" class="fr-label">
                                <roundcube:label name="listsorting" />
                            </label>
                            <div>
                                <select id="listoptions-sortcol" name="sort_col" class="fr-select">
                                    <option value="">
                                        <roundcube:label name="nonesort" />
                                    </option>
                                    <option value="arrival">
                                        <roundcube:label name="arrival" />
                                    </option>
                                    <option value="date">
                                        <roundcube:label name="sentdate" />
                                    </option>
                                    <option value="subject">
                                        <roundcube:label name="subject" />
                                    </option>
                                    <option value="fromto">
                                        <roundcube:label name="fromto" />
                                    </option>
                                    <option value="from">
                                        <roundcube:label name="from" />
                                    </option>
                                    <option value="to">
                                        <roundcube:label name="to" />
                                    </option>
                                    <option value="cc">
                                        <roundcube:label name="cc" />
                                    </option>
                                    <option value="size">
                                        <roundcube:label name="size" />
                                    </option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <!-- Options pour définir l'ordre de tri -->
                            <label for="listoptions-sortord" class="fr-label">
                                <roundcube:label name="listorder" />
                            </label>
                            <div>
                                <select id="listoptions-sortord" name="sort_ord" class="fr-select">
                                    <option value="ASC">
                                        <roundcube:label name="asc" />
                                    </option>
                                    <option value="DESC">
                                        <roundcube:label name="desc" />
                                    </option>
                                </select>
                            </div>
                        </div>
                        <roundcube:if condition="env:threads" />
                        <div class="form-group">
                            <!-- Options pour choisir le mode d'affichage des messages : liste simple ou threads -->
                            <label for="listoptions-threads" class="fr-label">
                                <roundcube:label name="lmode" />
                            </label>
                            <div>
                                <select id="listoptions-threads" name="mode" class="fr-select">
                                    <option value="list">
                                        <roundcube:label name="list" />
                                    </option>
                                    <option value="threads">
                                        <roundcube:label name="threads" />
                                    </option>
                                </select>
                            </div>
                        </div>
                        <roundcube:endif />
                    </div>
                </div>
            </div>
        </div>
    </div>
</dialog>

<!-- Modale pour les options de gestion des threads -->
<dialog aria-labelledby="fr-modal-threadselect-title" id="fr-modal-threadselect" class="fr-modal" role="dialog">
    <div class="fr-container fr-container--fluid fr-container-md">
        <div class="fr-grid-row fr-grid-row--center">
            <div class="fr-col-12 fr-col-md-8 fr-col-lg-6">
                <div class="fr-modal__body">
                    <div class="fr-modal__header">
                        <button class="fr-btn--close fr-btn" aria-controls="fr-modal-threadselect">Fermer</button>
                    </div>
                    <div class="fr-modal__content">
                        <h1 id="fr-modal-threadselect-title" class="fr-modal__title">
                            <span class="fr-icon-share-line fr-icon--lg"></span>
                            Gestion des threads
                        </h1>
                        <ul class="menu listing">
                            <!-- Options pour gérer l'affichage des threads -->
                            <button type="button" class="fr-btn fr-btn--secondary">Développer les non lus</button>
                            <button type="button" class="fr-btn fr-btn--secondary">Tout développer</button>
                            <button type="button" class="fr-btn fr-btn--secondary">Tout réduire</button>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</dialog>

<!-- Modale pour les options de la boîte aux lettres -->
<dialog aria-labelledby="fr-modal-mailboxoptions-title" id="fr-modal-mailboxoptions" class="fr-modal" role="dialog">
    <div class="fr-container fr-container--fluid fr-container-md">
        <div class="fr-grid-row fr-grid-row--center">
            <div class="fr-col-12 fr-col-md-8 fr-col-lg-6">
                <div class="fr-modal__body">
                    <div class="fr-modal__header">
                        <button class="fr-btn--close fr-btn" aria-controls="fr-modal-mailboxoptions">Fermer</button>
                    </div>
                    <div class="fr-modal__content">
                        <h1 id="fr-modal-mailboxoptions-title" class="fr-modal__title">
                            <span class="fr-icon-folder-3-line fr-icon--lg"></span>
                            Options de la boîte aux lettres
                        </h1>
                        <ul class="menu listing">
                            <!-- Options pour gérer les dossiers de courriel -->
                            <button type="button" class="fr-btn fr-btn--secondary">Compacter</button>
                            <button type="button" class="fr-btn fr-btn--secondary">Vider</button>
                            <button type="button" class="fr-btn fr-btn--secondary">Tout marquer comme lu</button>
                            <button type="button" class="fr-btn fr-btn--secondary">Gérer les dossiers</button>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</dialog>